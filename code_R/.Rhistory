train %>%
data_grid(t = seq_range(t, n = 100), idx) %>%
add_predicted_draws(m_covariation_posterior) %>%
ggplot(aes(x = t, y = y)) +
stat_lineribbon(aes(y = .prediction),
.width = c(.95, .8),
color = "#08519C") + # hdi interval?
geom_jitter(data = train,
color = "navyblue",
shape = 1,
alpha = 0.5,
size = 2,
width = 0.1) +
scale_fill_brewer() +
ggtitle("title")
train %>%
data_grid(t = seq_range(t, n = 100), idx) %>%
add_predicted_draws(m_covariation_posterior) %>%
ggplot(aes(x = t, y = y)) +
stat_lineribbon(aes(y = .prediction,
allow_new_levels = T),
.width = c(.95, .8),
color = "#08519C") + # hdi interval?
geom_jitter(data = train,
color = "navyblue",
shape = 1,
alpha = 0.5,
size = 2,
width = 0.1) +
scale_fill_brewer() +
ggtitle("title")
train %>%
data_grid(t = seq_range(t, n = 100), idx) %>%
add_predicted_draws(m_covariation_posterior,
allow_new_levels = T) %>%
ggplot(aes(x = t, y = y)) +
stat_lineribbon(aes(y = .prediction),
.width = c(.95, .8),
color = "#08519C") + # hdi interval?
geom_jitter(data = train,
color = "navyblue",
shape = 1,
alpha = 0.5,
size = 2,
width = 0.1) +
scale_fill_brewer() +
ggtitle("title")
test <- read_csv("../data/test.csv") %>%
mutate(idx = as_factor(idx))
test %>%
data_grid(t = seq_range(t, n = 100), idx) %>%
add_predicted_draws(m_covariation_posterior,
allow_new_levels = T) %>%
ggplot(aes(x = t, y = y)) +
stat_lineribbon(aes(y = .prediction),
.width = c(.95, .8),
color = "#08519C") + # hdi interval?
geom_jitter(data = train,
color = "navyblue",
shape = 1,
alpha = 0.5,
size = 2,
width = 0.1) +
scale_fill_brewer() +
ggtitle("title")
test %>%
data_grid(t = seq_range(t, n = 100), idx) %>%
add_predicted_draws(m_covariation_posterior,
allow_new_levels = T) %>%
ggplot(aes(x = t, y = y)) +
stat_lineribbon(aes(y = .prediction),
.width = c(.95, .8),
color = "#08519C") + # hdi interval?
geom_jitter(data = test,
color = "navyblue",
shape = 1,
alpha = 0.5,
size = 2,
width = 0.1) +
scale_fill_brewer() +
ggtitle("title")
test %>%
data_grid(t = seq_range(t, n = 100), idx) %>%
add_predicted_draws(m_covariation_posterior) %>%
ggplot(aes(x = t, y = y)) +
stat_lineribbon(aes(y = .prediction),
.width = c(.95, .8),
color = "#08519C") + # hdi interval?
geom_jitter(data = test,
color = "navyblue",
shape = 1,
alpha = 0.5,
size = 2,
width = 0.1) +
scale_fill_brewer() +
ggtitle("title")
test
unique(test$idx)
idx_unique <- unique(test$idx)
idx_unique <- as_numeric(unique(test$idx))
idx_unique <- as.numeric(unique(test$idx))
for i in idx_unique:
install.packages("fstrings")
for i in idx_unique:
pacman::p_load(fstrings)
for i in idx_unique:
devtools::install_github("jimhester/fstrings")
library(fstrings)
pacman::p_load(fstrings)
f('My name is {idx}')
devtools::install_github("jimhester/fstrings")
pacman::p_load(glue)
f('My name is {idx}')
f('My name is {idx}')
glue('My name is {idx}')
idx <- 1
glue('My name is {idx}')
for {ID in idx_unique}:
print(ID)
for (ID in idx_unique){
print(ID)
}
# Chunk 1
# packages
pacman::p_load(tidyverse,
brms,
modelr,
tidybayes,
bayesplot)
# load functions from fun_models.R
source("fun_models.R")
source("fun_helper.R")
# Chunk 2
# sampled models
m_covariation_posterior <- readRDS("../models_R/m_covariation_generic_fit.rds")
# Chunk 3
# read test data
test <- read_csv("../data/test.csv") %>%
mutate(idx = as_factor(idx))
# Chunk 4
prediction_interval_groups(
fit = m_covariation_posterior,
title = "R/brms: Predictions intervals (predictions)",
data = test
)
save_plot(
path = "../plots_R/covariation_generic_HDI_predictions.png"
)
# Chunk 5
# get unique idx
idx_unique <- as.numeric(unique(test$idx))
# loop over idx and use function
for (ID in idx_unique){
# generate plot
hdi_ID(fit = m_covariation_posterior,
data = test,
ID = ID)
# save plot
save_plot(path = glue("../plots_R/covaration_generic_HDI_individual{ID}_test.png"))
}
# Chunk 1
# packages
pacman::p_load(tidyverse,
brms,
modelr,
tidybayes,
bayesplot)
# load functions from fun_models.R
source("fun_models.R")
source("fun_helper.R")
# Chunk 2
# sampled models
m_covariation_posterior <- readRDS("../models_R/m_covariation_generic_fit.rds")
# Chunk 3
# read test data
test <- read_csv("../data/test.csv") %>%
mutate(idx = as_factor(idx))
# Chunk 4
prediction_interval_groups(
fit = m_covariation_posterior,
title = "R/brms: Predictions intervals (predictions)",
data = test
)
save_plot(
path = "../plots_R/covariation_generic_HDI_predictions.png"
)
# Chunk 5
# get unique idx
idx_unique <- as.numeric(unique(test$idx))
# loop over idx and use function
for (ID in idx_unique){
# generate plot
hdi_ID(fit = m_covariation_posterior,
data = test,
ID = ID)
# save plot
save_plot(path = glue("../plots_R/covariation_generic_HDI_individual{ID}_test.png"))
}
View(test)
# get unique idx
idx_unique <- as.numeric(unique(test$idx))
# get unique idx
idx_unique <- as.numeric(unique(test$idx) - 1)
# get unique idx
idx_unique <- unique(test$idx)
# loop over idx and use function
for (ID in idx_unique){
hdi_ID(fit = m_covariation_posterior,
data = test,
ID = ID)
}
# get unique idx
idx_unique <- as_numeric(unique(test$idx)) - 1
# get unique idx
idx_unique <- as.numeric(unique(test$idx)) - 1
# loop over idx and use function
for (ID in idx_unique){
hdi_ID(fit = m_covariation_posterior,
data = test,
ID = ID)
}
# get unique idx
idx_unique <- as.numeric(unique(test$idx)) - 1
# loop over idx and use function
for (ID in idx_unique){
# generate plot
hdi_ID(fit = m_covariation_posterior,
data = test,
ID = ID)
# save plot
save_plot(path = glue("../plots_R/covariation_generic_HDI_individual{ID}_test.png"))
}
# Chunk 1
# packages
pacman::p_load(tidyverse,
brms,
modelr,
tidybayes,
bayesplot,
glue)
RANDOM_SEED = 42
# load functions from fun_models.R
source("fun_models.R")
source("fun_helper.R")
# Chunk 2
# Only this is flexible at the moment. Not as nice as the python setup.
n_pp = 100
# Chunk 3
# load data
train <- read_csv("../data/train.csv") %>%
mutate(idx = as_factor(idx))
# Chunk 4
#formula
f_covariation <- bf(y ~ 0 + Intercept + t + (1+t|idx))
# Chunk 5
# fit the first model
get_prior(formula = f_covariation,
data = train,
family = gaussian)
# set priors: three levels.
prior_covariation_specific <- c(
prior(normal(0, 0.05), class = b, coef = t),
prior(normal(1.5, 0.05), class = b, coef = Intercept),
prior(normal(0, 0.05), class = sd),
prior(normal(0, 0.05), class = sigma),
prior(lkj(2), class = cor)
)
prior_covariation_generic <- c(
prior(normal(0, 0.5), class = b, coef = t),
prior(normal(1.5, 0.5), class = b, coef = Intercept),
prior(normal(0, 0.5), class = sd),
prior(normal(0, 0.5), class = sigma),
prior(lkj(1), class = cor)
)
prior_covariation_weak <- c(
prior(normal(0, 5), class = b, coef = t),
prior(normal(1.5, 5), class = b, coef = Intercept),
prior(normal(0, 5), class = sd),
prior(normal(0, 5), class = sigma),
prior(lkj(1), class = cor)
)
# Chunk 6
# compile the models
m_covariation_specific_prior <- fit_mod(
formula = f_covariation,
family = gaussian,
data = train,
prior = prior_covariation_specific,
sample_prior = "only",
file = "../models_R/m_covariation_specific_prior",
random_seed = RANDOM_SEED
)
m_covariation_generic_prior <- fit_mod(
formula = f_covariation,
family = gaussian,
data = train,
prior = prior_covariation_generic,
sample_prior = "only",
file = "../models_R/m_covariation_generic_prior",
random_seed = RANDOM_SEED
)
m_covariation_weak_prior <- fit_mod(
formula = f_covariation,
family = gaussian,
data = train,
prior = prior_covariation_weak,
sample_prior = "only",
file = "../models_R/m_covariation_weak_prior",
random_seed = RANDOM_SEED
)
# Chunk 7
# specific model
covariation_specific_prior_pred <- pp_check(m_covariation_specific_prior,
nsamples = 100) +
labs(title = "R/brms: prior predictive check")
save_plot(path = "../plots_R/covariation_specific_prior_pred.png")
# generic model
covariation_generic_prior_pred <- pp_check(m_covariation_generic_prior,
nsamples = 100) +
labs(title = "R/brms: prior predictive check")
save_plot(path = "../plots_R/covariation_generic_prior_pred.png")
# weak model
covariation_weak_prior_pred <- pp_check(m_covariation_weak_prior,
nsamples = 100) +
labs(title = "R/brms: prior predictive check")
save_plot(path = "../plots_R/covariation_weak_prior_pred.png")
# Chunk 8
# fit the models
m_covariation_specific_fit <- fit_mod(
formula = f_covariation,
family = gaussian,
data = train,
prior = prior_covariation_specific,
sample_prior = TRUE,
file = "../models_R/m_covariation_specific_fit",
random_seed = RANDOM_SEED
)
m_covariation_generic_fit <- fit_mod(
formula = f_covariation,
family = gaussian,
data = train,
prior = prior_covariation_generic,
sample_prior = TRUE,
file = "../models_R/m_covariation_generic_fit",
random_seed = RANDOM_SEED
)
m_covariation_weak_fit <- fit_mod(
formula = f_covariation,
family = gaussian,
data = train,
prior = prior_covariation_weak,
sample_prior = TRUE,
file = "../models_R/m_covariation_weak_fit",
random_seed = RANDOM_SEED
)
# Chunk 9
# specific model
save_chains(
fit = m_covariation_specific_fit,
path = "../plots_R/covariation_specific_plot_trace.png"
)
# generic model
save_chains(
fit = m_covariation_generic_fit,
path = "../plots_R/covariation_generic_plot_trace.png"
)
# weak model
save_chains(
fit = m_covariation_weak_fit,
path = "../plots_R/covariation_weak_plot_trace.png"
)
# Chunk 10
# specific model
covariation_specific_posterior_pred <- pp_check(m_covariation_specific_fit,
nsamples = 100) +
labs(title = "R/brms: posterior predictive check")
save_plot(path = "../plots_R/covariation_specific_posterior_pred.png")
# generic model
covariation_generic_posterior_pred <- pp_check(m_covariation_generic_fit,
nsamples = 100) +
labs(title = "R/brms: posterior predictive check")
save_plot(path = "../plots_R/covariation_generic_posterior_pred.png")
# weak model
covariation_weak_posterior_pred <- pp_check(m_covariation_weak_fit,
nsamples = 100) +
labs(title = "R/brms: posterior predictive check")
save_plot(path = "../plots_R/covariation_weak_posterior_pred.png")
# Chunk 11
# specific
fixed_interval_groups(fit = m_covariation_specific_fit,
title = "R/brms: Prediction intervals (fixed)",
data = train,
n_time = 100)
save_plot(path = "../plots_R/covariation_specific_HDI_fixed.png")
# generic
fixed_interval_groups(fit = m_covariation_generic_fit,
title = "R/brms: Prediction intervals (fixed)",
data = train,
n_time = 100)
save_plot(path = "../plots_R/covariation_generic_HDI_fixed.png")
# weak
fixed_interval_groups(fit = m_covariation_weak_fit,
title = "R/brms: Prediction intervals (fixed)",
data = train,
n_time = 100)
save_plot(path = "../plots_R/covariation_weak_HDI_fixed.png")
# Chunk 12
# specific
prediction_interval_groups(fit = m_covariation_specific_fit,
title = "R/brms: Prediction intervals (full)",
data = train,
n_time = 100)
save_plot(path = "../plots_R/covariation_specific_HDI_full.png")
# generic
prediction_interval_groups(fit = m_covariation_generic_fit,
title = "R/brms: Prediction intervals (full)",
data = train,
n_time = 100)
save_plot(path = "../plots_R/covariation_generic_HDI_full.png")
# weak
prediction_interval_groups(fit = m_covariation_weak_fit,
title = "R/brms: Prediction intervals (full)",
data = train,
n_time = 100)
save_plot(path = "../plots_R/covariation_weak_HDI_full.png")
# Chunk 13
# get unique idx
idx_unique <- as.numeric(unique(test$idx)) - 1
# prep
prior_list = c("pooled", "intercept", "covariation")
model_list = c(m_covariation_specific_fit, m_covariation_generic_fit, m_covariation_weak_fit)
# loop over idx and use function
for (i in c(1, 2, 3)){
# generate predictions
for (ID in idx_unique){
hdi_ID(fit = model_list[i],
data = test,
ID = ID)
# save plot
save_plot(path = glue("../plots_R/covariation_{prior_list[i]}_HDI_individual{ID}_train.png"))
}
}
# Chunk 14
# for consistency with python.
# does not do anything at the moment..
width = 7
height = 4
# specific
mcmc_hdi(fit = m_covariation_specific_fit,
title = "R/brms: HDI intervals for parameters")
save_plot(path = "../plots_R/covariation_specific_HDI_param.png",
width = width,
height = height)
# generic
mcmc_hdi(fit = m_covariation_generic_fit,
title = "R/brms: HDI intervals for parameters")
save_plot(path = "../plots_R/covariation_generic_HDI_param.png",
width = width,
height = height)
# weak
mcmc_hdi(fit = m_covariation_weak_fit,
title = "R/brms: HDI intervals for parameters")
save_plot(path = "../plots_R/covariation_weak_HDI_param.png",
width = width,
height = height)
prior_list[1]
model_list[1]
# get unique idx
idx_unique <- as.numeric(unique(test$idx)) - 1
# prep
prior_list = c("pooled", "intercept", "covariation")
model_list = c(m_covariation_specific_fit, m_covariation_generic_fit, m_covariation_weak_fit)
# loop over idx and use function
for (i in c(1, 2, 3)){
for (ID in idx_unique){
# generate predictions
hdi_ID(fit = model_list[i],
data = test,
ID = ID)
# save plot
save_plot(path = glue("../plots_R/covariation_{prior_list[i]}_HDI_individual{ID}_train.png"))
}
}
# get unique idx
idx_unique <- as.numeric(unique(test$idx)) - 1
# specific
for (ID in idx_unique){
# generate predictions
hdi_ID(fit = m_covariation_specific_fit,
data = test,
ID = ID)
# save plot
save_plot(path = glue("../plots_R/covariation_specific_HDI_individual{ID}_train.png"))
}
# generic
for (ID in idx_unique){
# generate predictions
hdi_ID(fit = m_covariation_generic_fit,
data = test,
ID = ID)
# save plot
save_plot(path = glue("../plots_R/covariation_generic_HDI_individual{ID}_train.png"))
}
# weak
for (ID in idx_unique){
# generate predictions
hdi_ID(fit = m_covariation_weak_fit,
data = test,
ID = ID)
# save plot
save_plot(path = glue("../plots_R/covariation_weak_HDI_individual{ID}_train.png"))
}
