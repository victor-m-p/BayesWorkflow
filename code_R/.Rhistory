sample_prior = TRUE,
file = "../models_R/m_multilevel_generic_fit"
)
m_multilevel_weak_fit <- fit_mod(
formula = f_multilevel,
family = gaussian,
data = train,
prior = prior_multilevel_weak,
sample_prior = TRUE,
file = "../models_R/m_multilevel_weak_fit"
)
# Chunk 9
# specific model
save_chains(
fit = m_multilevel_specific_fit,
path = "../plots_R/multilevel_specific_plot_trace.png"
)
# generic model
save_chains(
fit = m_multilevel_generic_fit,
path = "../plots_R/multilevel_generic_plot_trace.png"
)
# weak model
save_chains(
fit = m_multilevel_weak_fit,
path = "../plots_R/multilevel_weak_plot_trace.png"
)
# Chunk 10
# specific model
multilevel_specific_posterior_pred <- pp_check(m_multilevel_specific_fit,
nsamples = 100) +
labs(title = "R/brms: posterior predictive check")
save_plot(path = "../plots_R/multilevel_specific_posterior_pred.png")
# generic model
multilevel_generic_posterior_pred <- pp_check(m_multilevel_generic_fit,
nsamples = 100) +
labs(title = "R/brms: posterior predictive check")
save_plot(path = "../plots_R/multilevel_generic_posterior_pred.png")
# weak model
multilevel_weak_posterior_pred <- pp_check(m_multilevel_weak_fit,
nsamples = 100) +
labs(title = "R/brms: posterior predictive check")
save_plot(path = "../plots_R/multilevel_weak_posterior_pred.png")
# Chunk 11
# specific
fixed_interval_groups(fit = m_multilevel_specific_fit,
title = "Fixed effect interval (.95, .8)",
data = train,
n_time = 100)
save_plot(path = "../plots_R/multilevel_specific_FI.png")
# generic
fixed_interval_groups(fit = m_multilevel_generic_fit,
title = "Fixed effect interval (.95, .8)",
data = train,
n_time = 100)
save_plot(path = "../plots_R/multilevel_generic_FI.png")
# weak
fixed_interval_groups(fit = m_multilevel_weak_fit,
title = "Fixed effect interval (.95, .8)",
data = train,
n_time = 100)
save_plot(path = "../plots_R/multilevel_weak_FI.png")
# Chunk 12
# specific
prediction_interval_groups(fit = m_multilevel_specific_fit,
title = "Prediction interval (.95, .8)",
data = train,
n_time = 100)
save_plot(path = "../plots_R/multilevel_specific_PI.png")
# generic
prediction_interval_groups(fit = m_multilevel_generic_fit,
title = "Prediction interval (.95, .8)",
data = train,
n_time = 100)
save_plot(path = "../plots_R/multilevel_generic_PI.png")
# weak
prediction_interval_groups(fit = m_multilevel_weak_fit,
title = "Prediction interval (.95, .8)",
data = train,
n_time = 100)
save_plot(path = "../plots_R/multilevel_weak_PI.png")
# Chunk 13
# for consistency with python.
# does not do anything at the moment..
width = 7
height = 4
# specific
mcmc_hdi(fit = m_multilevel_specific_fit,
title = "R/brms: HDI intervals for parameters")
save_plot(path = "../plots_R/multilevel_specific_hdi_param.png",
width = width,
height = height)
# generic
mcmc_hdi(fit = m_multilevel_generic_fit,
title = "R/brms: HDI intervals for parameters")
save_plot(path = "../plots_R/multilevel_generic_hdi_param.png",
width = width,
height = height)
# weak
mcmc_hdi(fit = m_multilevel_weak_fit,
title = "R/brms: HDI intervals for parameters")
save_plot(path = "../plots_R/multilevel_generic_hdi_param.png",
width = width,
height = height)
# Chunk 1
# working directory
setwd("~/BayesWorkflow/code_r")
# packages
pacman::p_load(tidyverse,
brms,
kableExtra,
magick,
webshot,
modelr,
tidybayes)
# load functions from fun_models.R
source("fun_models.R")
source("fun_helper.R")
# Chunk 2
# Only this is flexible at the moment. Not as nice as the python setup.
n_pp = 100
# Chunk 3
# load data
train <- read_csv("../data/train.csv") %>%
mutate(idx = as_factor(idx))
# Chunk 4
#formula
f_student <- bf(y ~ 1 + t + (1+t|idx)) # complete pooling
# Chunk 5
# fit the first model
get_prior(formula = f_student,
data = train,
family = student,
)
# set priors: three levels.
prior_student_specific <- c(
prior(normal(0, 0.05), class = b),
prior(normal(1.5, 0.05), class = Intercept),
prior(normal(0, 0.05), class = sd),
prior(normal(0, 0.05), class = sigma),
prior(lkj(1), class = cor),
prior(gamma(2, 0.1), class = nu) # same as in python.
)
prior_student_generic <- c(
prior(normal(0, 0.5), class = b),
prior(normal(1.5, 0.5), class = Intercept),
prior(normal(0, 0.5), class = sd),
prior(normal(0, 0.5), class = sigma),
prior(lkj(1), class = cor),
prior(gamma(2, 0.1), class = nu)
)
prior_student_weak <- c(
prior(normal(0, 5), class = b),
prior(normal(1.5, 5), class = Intercept),
prior(normal(0, 5), class = sd),
prior(normal(0, 5), class = sigma),
prior(lkj(1), class = cor),
prior(gamma(2, 0.1), class = nu)
)
# Chunk 6
# compile the models
m_student_specific_prior <- fit_mod(
formula = f_student,
family = student,
data = train,
prior = prior_student_specific,
sample_prior = "only",
file = "../models_R/m_student_specific_prior"
)
m_student_generic_prior <- fit_mod(
formula = f_student,
family = student,
data = train,
prior = prior_student_generic,
sample_prior = "only",
file = "../models_R/m_student_generic_prior"
)
m_student_weak_prior <- fit_mod(
formula = f_student,
family = student,
data = train,
prior = prior_student_weak,
sample_prior = "only",
file = "../models_R/m_student_weak_prior"
)
# Chunk 7
# specific model
student_specific_prior_pred <- pp_check(m_student_specific_prior,
nsamples = 100) +
labs(title = "R/brms: prior predictive check")
save_plot(path = "../plots_R/student_specific_prior_pred.png")
# generic model
student_generic_prior_pred <- pp_check(m_student_generic_prior,
nsamples = 100) +
labs(title = "R/brms: prior predictive check")
save_plot(path = "../plots_R/student_generic_prior_pred.png")
# weak model
student_weak_prior_pred <- pp_check(m_student_weak_prior,
nsamples = 100) +
labs(title = "R/brms: prior predictive check")
save_plot(path = "../plots_R/student_weak_prior_pred.png")
# Chunk 8
# fit the models
m_student_specific_fit <- fit_mod(
formula = f_student,
family = student,
data = train,
prior = prior_student_specific,
sample_prior = TRUE,
file = "../models_R/m_student_specific_fit"
)
m_student_generic_fit <- fit_mod(
formula = f_student,
family = student,
data = train,
prior = prior_student_generic,
sample_prior = TRUE,
file = "../models_R/m_student_generic_fit"
)
m_student_weak_fit <- fit_mod(
formula = f_student,
family = student,
data = train,
prior = prior_student_weak,
sample_prior = TRUE,
file = "../models_R/m_student_weak_fit"
)
# Chunk 9
# specific model
save_chains(
fit = m_student_specific_fit,
path = "../plots_R/student_specific_plot_trace.png"
)
# generic model
save_chains(
fit = m_student_generic_fit,
path = "../plots_R/student_generic_plot_trace.png"
)
# weak model
save_chains(
fit = m_student_weak_fit,
path = "../plots_R/student_weak_plot_trace.png"
)
# Chunk 10
# specific model
student_specific_posterior_pred <- pp_check(m_student_specific_fit,
nsamples = 100) +
labs(title = "R/brms: posterior predictive check")
save_plot(path = "../plots_R/student_specific_posterior_pred.png")
# generic model
student_generic_posterior_pred <- pp_check(m_student_generic_fit,
nsamples = 100) +
labs(title = "R/brms: posterior predictive check")
save_plot(path = "../plots_R/student_generic_posterior_pred.png")
# weak model
student_weak_posterior_pred <- pp_check(m_student_weak_fit,
nsamples = 100) +
labs(title = "R/brms: posterior predictive check")
save_plot(path = "../plots_R/student_weak_posterior_pred.png")
# Chunk 11
# specific
fixed_interval_groups(fit = m_student_specific_fit,
title = "Fixed effect interval (.95, .8)",
data = train,
n_time = 100)
save_plot(path = "../plots_R/student_specific_FI.png")
# generic
fixed_interval_groups(fit = m_student_generic_fit,
title = "Fixed effect interval (.95, .8)",
data = train,
n_time = 100)
save_plot(path = "../plots_R/student_generic_FI.png")
# weak
fixed_interval_groups(fit = m_student_weak_fit,
title = "Fixed effect interval (.95, .8)",
data = train,
n_time = 100)
save_plot(path = "../plots_R/student_weak_FI.png")
# Chunk 12
# specific
prediction_interval_groups(fit = m_student_specific_fit,
title = "Prediction interval (.95, .8)",
data = train,
n_time = 100)
save_plot(path = "../plots_R/student_specific_PI.png")
# generic
prediction_interval_groups(fit = m_student_generic_fit,
title = "Prediction interval (.95, .8)",
data = train,
n_time = 100)
save_plot(path = "../plots_R/student_generic_PI.png")
# weak
prediction_interval_groups(fit = m_student_weak_fit,
title = "Prediction interval (.95, .8)",
data = train,
n_time = 100)
save_plot(path = "../plots_R/student_weak_PI.png")
# Chunk 13
# for consistency with python.
# does not do anything at the moment..
width = 7
height = 4
# specific
mcmc_hdi(fit = m_student_specific_fit,
title = "R/brms: HDI intervals for parameters")
save_plot(path = "../plots_R/student_specific_hdi_param.png",
width = width,
height = height)
# generic
mcmc_hdi(fit = m_student_generic_fit,
title = "R/brms: HDI intervals for parameters")
save_plot(path = "../plots_R/student_generic_hdi_param.png",
width = width,
height = height)
# weak
mcmc_hdi(fit = m_student_weak_fit,
title = "R/brms: HDI intervals for parameters")
save_plot(path = "../plots_R/student_generic_hdi_param.png",
width = width,
height = height)
# Chunk 1
# working directory
setwd("~/BayesWorkflow/code_r")
# packages
pacman::p_load(tidyverse,
brms,
kableExtra,
magick,
webshot,
modelr,
tidybayes)
# load functions from fun_helper.R
source("fun_helper.R")
# Chunk 2
# load data
train <- read_csv("../data/train.csv")
# make sure that data format is okay
train <- train %>%
mutate(idx = as_factor(idx))
# Chunk 3
# prior fits
m_pooled_prior <- readRDS("../models_R/m_pooled_generic_prior.rds")
m_multilevel_prior <- readRDS("../models_R/m_multilevel_generic_prior.rds")
m_student_prior <- readRDS("../models_R/m_student_generic_prior.rds")
# sampled models
m_pooled_posterior <- readRDS("../models_R/m_pooled_generic_fit.rds")
m_multilevel_posterior <- readRDS("../models_R/m_multilevel_generic_fit.rds")
m_student_posterior <- readRDS("../models_R/m_student_generic_fit.rds")
# Chunk 4
# add criterions
m_pooled_posterior <- add_criterion(m_pooled_posterior,
criterion = c("loo", "bayes_R2"))
m_multilevel_posterior <- add_criterion(m_multilevel_posterior,
criterion = c("loo", "bayes_R2"))
m_student_posterior <- add_criterion(m_student_posterior,
criterion = c("loo", "bayes_R2"),
moment_match = TRUE) # one problematic observation.
# run loo compare
loo_compare(m_pooled_posterior,
m_multilevel_posterior,
m_student_posterior)
# also uses stacking (and gives the same as pyMC3)
loo_model_weights(m_pooled_posterior,
m_multilevel_posterior,
m_student_posterior)
# add criterions
m_pooled_posterior <- add_criterion(m_pooled_posterior,
criterion = c("loo", "bayes_R2"))
m_multilevel_posterior <- add_criterion(m_multilevel_posterior,
criterion = c("loo", "bayes_R2"))
m_student_posterior <- add_criterion(m_student_posterior,
criterion = c("loo", "bayes_R2"),
moment_match = TRUE) # one problematic observation.
# run loo compare
loo_compare(m_pooled_posterior,
m_multilevel_posterior,
m_student_posterior)
# also uses stacking (and gives the same as pyMC3)
loo_model_weights(m_pooled_posterior,
m_multilevel_posterior,
m_student_posterior)
# run loo compare
loo_compare(m_pooled_posterior,
m_multilevel_posterior,
m_student_posterior)
# working directory
setwd("~/BayesWorkflow/code_r")
# packages
pacman::p_load(tidyverse,
brms,
kableExtra,
magick,
webshot,
modelr,
tidybayes)
# load functions from fun_helper.R
source("fun_helper.R")
# load data
train <- read_csv("../data/train.csv")
# make sure that data format is okay
train <- train %>%
mutate(idx = as_factor(idx))
# prior fits
m_pooled_prior <- readRDS("../models_R/m_pooled_generic_prior.rds")
m_multilevel_prior <- readRDS("../models_R/m_multilevel_generic_prior.rds")
m_student_prior <- readRDS("../models_R/m_student_generic_prior.rds")
# sampled models
m_pooled_posterior <- readRDS("../models_R/m_pooled_generic_fit.rds")
m_multilevel_posterior <- readRDS("../models_R/m_multilevel_generic_fit.rds")
m_student_posterior <- readRDS("../models_R/m_student_generic_fit.rds")
# working directory
setwd("~/BayesWorkflow/code_r")
# packages
pacman::p_load(tidyverse,
brms,
kableExtra,
magick,
webshot,
modelr,
tidybayes)
# load functions from fun_helper.R
source("fun_helper.R")
# load data
train <- read_csv("../data/train.csv")
# make sure that data format is okay
train <- train %>%
mutate(idx = as_factor(idx))
# sampled models
m_pooled_posterior <- readRDS("../models_R/m_pooled_generic_fit.rds")
m_multilevel_posterior <- readRDS("../models_R/m_multilevel_generic_fit.rds")
m_student_posterior <- readRDS("../models_R/m_student_generic_fit.rds")
# add criterions
m_pooled_posterior <- add_criterion(m_pooled_posterior,
criterion = c("loo", "bayes_R2"))
m_multilevel_posterior <- add_criterion(m_multilevel_posterior,
criterion = c("loo", "bayes_R2"))
m_student_posterior <- add_criterion(m_student_posterior,
criterion = c("loo", "bayes_R2"),
moment_match = TRUE) # one problematic observation.
# run loo compare
loo_compare(m_pooled_posterior,
m_multilevel_posterior,
m_student_posterior)
# add criterions
m_pooled_posterior <- add_criterion(m_pooled_posterior,
criterion = c("loo", "bayes_R2"))
m_multilevel_posterior <- add_criterion(m_multilevel_posterior,
criterion = c("loo", "bayes_R2"))
m_student_posterior <- add_criterion(m_student_posterior,
criterion = c("loo", "bayes_R2")) # one problematic observation.
# run loo compare
loo_compare(m_pooled_posterior,
m_multilevel_posterior,
m_student_posterior)
# also uses stacking (and gives the same as pyMC3)
loo_model_weights(m_pooled_posterior,
m_multilevel_posterior,
m_student_posterior)
# Chunk 1
# working directory
setwd("~/BayesWorkflow/code_r")
# packages
pacman::p_load(tidyverse,
brms,
modelr,
tidybayes)
# load functions from fun_models.R
source("fun_models.R")
source("fun_helper.R")
# Chunk 2
# sampled models
m_pooled_posterior <- readRDS("../models_R/m_pooled_generic_fit.rds")
# Chunk 3
# read test data
test <- read_csv("../data/test.csv") %>%
mutate(idx = as_factor(idx))
# Chunk 4
plot_predicted_groups(
fit = m_pooled_posterior,
title = "R/brms: Predictions intervals (.95, .8 HDI) unseen data",
data = test
)
save_plot(
path = "multilevel_generic_HDI_predictions.png"
)
# Chunk 1
# working directory
setwd("~/BayesWorkflow/code_r")
# packages
pacman::p_load(tidyverse,
brms,
modelr,
tidybayes)
# load functions from fun_models.R
source("fun_models.R")
source("fun_helper.R")
# Chunk 2
# sampled models
m_pooled_posterior <- readRDS("../models_R/m_multilevel_generic_fit.rds")
# Chunk 3
# read test data
test <- read_csv("../data/test.csv") %>%
mutate(idx = as_factor(idx))
# Chunk 4
plot_predicted_groups(
fit = m_pooled_posterior,
title = "R/brms: Predictions intervals (.95, .8 HDI) unseen data",
data = test
)
save_plot(
path = "../plots_R/multilevel_generic_HDI_predictions.png"
)
